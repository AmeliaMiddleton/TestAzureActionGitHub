# Azure Deployment Setup Script Context

## File: `setup-azure-deployment.ps1`

### Overview
This PowerShell script automates the creation and configuration of Azure Web Apps for .NET applications, specifically designed for GitHub Actions deployment workflows.

### Purpose
- Creates Azure infrastructure for hosting .NET web applications
- Configures web apps with proper .NET 8.0 runtime settings
- Generates publish profiles for GitHub Actions deployment
- Updates GitHub workflow files automatically
- Provides interactive setup with comprehensive options

### Key Features

#### 1. Prerequisites Validation
- Checks if Azure CLI is installed and accessible
- Verifies Azure login status
- Exits with error messages if prerequisites are not met

#### 2. Interactive Configuration
- **Web App Name**: User-defined name for the Azure Web App
- **Resource Group**: User-defined resource group name
- **Region Selection**: Comprehensive list of 12 popular Azure regions with descriptions
- **Tier Selection**: Detailed pricing and specification information for all App Service Plan tiers:
  - Free (F1): $0/month, shared resources, 1GB RAM, 60 min/day CPU
  - Basic (B1-B3): $12-60/month, dedicated resources
  - Standard (S1-S3): $70-320/month, auto-scaling capabilities
  - Premium (P1V2-P3V2): $140-640/month, advanced features
  - Isolated (I1-I2): $280-640/month, VNet integration

#### 3. Azure Resource Creation
- **Resource Group**: Creates the specified resource group in the selected region
- **App Service Plan**: Creates a plan with the selected tier and specifications
- **Web App**: Creates a Linux-based web app with .NET 8.0 runtime

#### 4. Web App Configuration
- **Startup Command**: Sets `dotnet TestAzureActionGithub.dll` as the startup file
- **Runtime**: Automatically configured as .NET 8.0 on Linux via `--runtime "dotnet:8"`

#### 5. Publish Profile Generation
- Downloads the web app's publish profile in XML format
- Saves it to `publish-profile.xml` in the current directory
- Contains deployment credentials and URLs for GitHub Actions

#### 6. Workflow File Updates
- Automatically updates `.github/workflows/azure-deploy.yml` with the new web app name
- Automatically updates `.github/workflows/azure-deploy-advanced.yml` with the new web app name
- Uses regex replacement to update the `AZURE_WEBAPP_NAME` environment variable

#### 7. User Guidance
- **Clipboard Integration**: Copies secret name and publish profile content to clipboard
- **Step-by-step Instructions**: Guides users through GitHub secret creation process
- **Error Handling**: Provides helpful error messages and troubleshooting suggestions

### Technical Details

#### Azure CLI Commands Used
```powershell
# Resource creation
az group create --name $ResourceGroupName --location $Location
az appservice plan create --name "$WebAppName-plan" --resource-group $ResourceGroupName --location $Location --sku $Sku
az webapp create --resource-group $ResourceGroupName --plan "$WebAppName-plan" --name $WebAppName

# Configuration
az webapp config set --resource-group $ResourceGroupName --name $WebAppName --startup-file "dotnet TestAzureActionGithub.dll"

# Publish profile
az webapp deployment list-publishing-profiles --resource-group $ResourceGroupName --name $WebAppName --xml
```

#### PowerShell Features
- **Error Handling**: Comprehensive try-catch blocks and exit code checking
- **User Input**: Interactive prompts with validation
- **File Operations**: Reading and writing workflow files with error handling
- **Clipboard Integration**: Using `Set-Clipboard` for user convenience
- **Color Output**: Colored console output for better user experience

### Known Issues and Workarounds

#### 1. PowerShell Pipe Character Parsing
- **Issue**: No longer applicable - Linux web apps use `--runtime "dotnet:8"` which doesn't contain pipe characters
- **Solution**: Linux runtime specification is straightforward and doesn't require workarounds

#### 2. Runtime Configuration
- **Current Approach**: Creates Linux web app with `--runtime "dotnet:8"` for proper .NET 8.0 configuration
- **Benefits**: Simpler configuration, no pipe character issues, better compatibility with modern .NET

### Usage Instructions

#### Prerequisites
1. Install Azure CLI: https://docs.microsoft.com/en-us/cli/azure/install-azure-cli
2. Login to Azure: `az login`
3. Ensure PowerShell execution policy allows script execution

#### Running the Script
```powershell
# Navigate to project directory
cd C:\Users\ameli\source\repos\TestAzureActionGithub

# Run the script
.\setup-azure-deployment.ps1
```

#### Post-Script Steps
1. Update GitHub secret `AZURE_WEBAPP_PUBLISH_PROFILE` with the generated publish profile content
2. Commit and push the updated workflow files
3. Trigger GitHub Actions deployment

### Output Files
- `publish-profile.xml`: Contains Azure Web App deployment credentials
- Updated `.github/workflows/azure-deploy.yml`: Basic deployment workflow
- Updated `.github/workflows/azure-deploy-advanced.yml`: Advanced deployment workflow

### Integration with GitHub Actions
- **Secret Name**: `AZURE_WEBAPP_PUBLISH_PROFILE`
- **Workflow Files**: Automatically updated with correct web app name
- **Deployment Target**: Linux-based Azure Web App with .NET 8.0 runtime
- **Compatibility**: Designed for `ubuntu-latest` GitHub Actions runners

### Cost Considerations
- **Free Tier (F1)**: Suitable for development/testing, but has limitations
- **Basic Tier (B1)**: Recommended minimum for small production workloads (~$12-15/month)
- **Standard Tiers**: Recommended for production with auto-scaling capabilities
- **Premium Tiers**: Advanced features like staging slots and custom domains

### Security Notes
- Publish profiles contain sensitive credentials and should be stored as GitHub secrets
- Resource group and web app names should follow Azure naming conventions
- Consider using managed identities for production deployments

### Troubleshooting
- **Quota Exceeded**: Try different regions or upgrade from Free to Basic tier
- **Name Conflicts**: Ensure web app name is globally unique
- **Runtime Issues**: Verify .NET 8.0 is properly configured via Azure portal (Linux runtime should be "dotnet:8")
- **Deployment Failures**: Check GitHub secret content matches publish profile exactly
